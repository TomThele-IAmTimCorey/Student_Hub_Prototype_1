<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Student Hub - Login</title>
  <link rel="stylesheet" href="style.css" />

  <script 
    //add to try to protect API keys
    src="config.gitignore">
  /script>

  <script>
    // SHA-256 hex of the password (computed from the password you specified).
    // This value is the HEX SHA-256 digest and DOES NOT reveal the plaintext password.
    const storedHashHex = "091594471122803fcd812738a1d63b19c8cf8cbb2f521e01a029a448a7e38d81";

    // helper: convert ArrayBuffer to hex string
    function bufferToHex(buffer) {
      const bytes = new Uint8Array(buffer);
      return Array.from(bytes).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    // compute SHA-256 of a UTF-8 string using Web Crypto API, returns hex string
    async function sha256Hex(message) {
      const encoder = new TextEncoder();
      const data = encoder.encode(message);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      return bufferToHex(hashBuffer);
    }

    function isValidEmail(email) {
      const regex = /^[^@\s]+@[^@\s]+\.[^@\s]+$/;
      return regex.test(email);
    }

    // Validate both email and password and update Submit button enabled state
    async function validateForm() {
      const email = document.getElementById("email").value.trim();
      const pwd = document.getElementById("password").value;
      const submitBtn = document.getElementById("submitBtn");

      // basic email check
      if (!isValidEmail(email)) {
        submitBtn.disabled = false;
        return;
      }

      // if password empty -> disable
      if (!pwd) {
        submitBtn.disabled = true;
        return;
      }

      // compute hash and compare (note: async)
      try {
        const hashHex = await sha256Hex(pwd);
        // enable submit only if hash matches stored hash
        submitBtn.disabled = (hashHex !== storedHashHex);
      } catch (e) {
        // any error -> disable submit
        submitBtn.disabled = true;
      }
    }

    // Called when the user clicks Submit (only reachable if enabled)
    function login() {
      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();

      // store login values for the prototype
      localStorage.setItem("login_name", name);
      localStorage.setItem("login_email", email);

      // navigate to the landing page
      window.location.href = "landing.html";
    }

    // attach listeners after DOM loads
    window.addEventListener("DOMContentLoaded", function () {
      const emailEl = document.getElementById("email");
      const pwdEl = document.getElementById("password");

      // validate when user types
      emailEl.addEventListener("input", validateForm);
      pwdEl.addEventListener("input", validateForm);

      // initial validation (in case fields are pre-filled)
      validateForm();
    });
  </script>
</head>
<body>
  <div class="login-container">
    <h1>Student Hub 2</h1>
    <h3>Presented by DevForge</h3>

    <input id="name" type="text" placeholder="Name" /><br>

    <input id="email" type="email" placeholder="Email" /><br>

    <!-- Password field: plaintext is never written to the HTML file by me.
         The comparison uses the SHA-256 hash stored above. -->
    <input id="password" type="password" placeholder="Password" /><br>

    <!-- Submit stays disabled until both email is valid and password matches hash -->
    <button id="submitBtn" onclick="login()" disabled>Submit</button>

    <p class="hint">Enter a valid email and the correct password to enable Submit.</p>
  </div>
</body>
</html>

